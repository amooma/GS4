<table>
  <tr>
    <th><%= t(:mac_address) %></th>
    <th><%= t(:phone_model) %></th>
    <th><%= t(:ip_address) %></th>
    <th></th>
    <th></th>
    <th></th>
  </tr>

<% phones.each do |phone| %>
  <tr>
    <td><%= link_to phone.mac_address_to_display, phone %></td>
    <td>
      <%= phone.phone_model.name %>
      <br />
      <small><%= t(:manufacturer) %>: <br /><%= truncate(phone.phone_model.manufacturer.name, :length => 20) %></small>
    </td>
    <td><%= phone.ip_address.blank? ? '-' : phone.ip_address  %></td>
    
    <% t = Time.now - 45.minutes %>
    <td class="<%= phone.created_at > t ? 'status_no' : '' %>">
    <% if phone.created_at > t %>
      <% if phone.rebootable? %>
        <%= link_to t(:reboot), phone_reboot_path(phone), :confirm => t(:do_really_reboot, :name => phone.phone_model.name) %>
      <% else %>
        <span style="font-size:4em; vertical-align:0%; float:left; display:block; margin:0 10px 10px 0;"><%= "\u{26A0}" %></span>
        <%= t(:phone_created_reboot_needed, :time_ago => time_ago_in_words(phone.created_at)) %>
        <% if ! phone.phone_model.manual_url.blank? %>
          <%= link_to t(:phone_manual, :phone_model => phone.phone_model.name), phone.phone_model.manual_url %>.
        <% end %>
        
        <% if ! NetworkSetting.first.try(:start_dhcp_server) %>
          <p>
            <%= t(:phone_set_config_url) %><br />
            <tt><%= "https://#{ @controller.guess_local_host }#{root_path}settings-{mac}" %></tt><%#OPTIMIZE Generalize setting URL. %>
          </p>
        <% end %>
      <% end %>
    <% else %>
      <% if phone.rebootable? %>
      <%= link_to t(:reboot), phone_reboot_path(phone), :confirm => t(:do_really_reboot, :name => phone.phone_model.name) %>
      <% else %>
      <%= t(:phone_not_yet_provisioned) %>
      <% end %>
    <% end %>
    </td>
    
    <td><%= link_to t(:edit), edit_phone_path(phone) %></td>
    <td><%= link_to t(:destroy), confirm_destroy_phone_path(phone) if can?( :destroy, phone ) %></td>
  </tr>
<% end %>
</table>
